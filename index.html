<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGE Game - Professional System</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        body { background-color: #000; color: #fff; text-align: center; font-family: sans-serif; margin: 0; padding: 10px; }
        
        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠÙ…ÙŠÙ† */
        .wallet-section { position: fixed; top: 10px; right: 10px; z-index: 1000; background: #1a1a1a; padding: 10px; border-radius: 12px; border: 1px solid #f1c40f; width: 150px; }
        .wallet-section input { width: 90%; font-size: 10px; padding: 5px; background: #000; color: #fff; border: 1px solid #333; margin-bottom: 5px; border-radius: 5px; }
        .wallet-section button { width: 100%; font-size: 10px; background: #f1c40f; color: #000; border: none; padding: 5px; border-radius: 5px; font-weight: bold; cursor: pointer; }

        .stat-box { background: linear-gradient(180deg, #1a1a1a, #000); padding: 30px 15px; border-radius: 20px; border: 2px solid #f1c40f; margin: 80px 10px 20px; }
        .balance { font-size: 40px; color: #f1c40f; font-weight: bold; }
        
        .tabs { display: flex; background: #111; border-radius: 12px; padding: 5px; margin: 10px; }
        .tab { flex: 1; padding: 10px; cursor: pointer; border-radius: 10px; color: #888; font-size: 13px; }
        .tab.active { background: #f1c40f; color: #000; font-weight: bold; }
        
        .section { display: none; padding: 10px; }
        .section.active { display: block; }
        
        .card { background: #1a1a1a; padding: 12px; border-radius: 15px; border: 1px solid #333; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .btn-action { background: #f1c40f; color: #000; border: none; padding: 8px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-done { background: #333 !important; color: #777 !important; cursor: not-allowed; }
        
        .ref-box { background: #111; padding: 15px; border-radius: 15px; border: 1px dashed #f1c40f; margin-top: 15px; }
        .leaderboard-list { text-align: right; }
        .rank-item { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid #222; }
    </style>
</head>
<body>

    <div class="wallet-section">
        <input type="text" id="wallet-addr" placeholder="Ø¹Ù†ÙˆØ§Ù† 0x...">
        <button id="save-btn" onclick="saveWallet()">Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø© âœ…</button>
    </div>

    <div class="stat-box">
        <div class="balance" id="score">0</div>
        <div id="username-display" style="color:#f1c40f; font-weight: bold;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    </div>

    <div class="tabs">
        <div class="tab active" onclick="switchTab('daily', this)">ÙŠÙˆÙ…ÙŠØ©</div>
        <div class="tab" onclick="switchTab('weekly', this)">Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</div>
        <div class="tab" onclick="switchTab('invite', this)">Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</div>
        <div class="tab" onclick="switchTab('rank', this)">Ø§Ù„ØªØµÙ†ÙŠÙ</div>
    </div>

    <div id="daily" class="section active">
        <div id="daily-list"></div>
    </div>

    <div id="weekly" class="section">
        <div id="weekly-list"></div>
    </div>

    <div id="invite" class="section">
        <div class="ref-box">
            <h4>Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø© $AGE</h4>
            <p style="font-size: 12px;">Ø§Ù†Ø³Ø® Ø±Ø§Ø¨Ø·Ùƒ ÙˆØ§Ø¯Ø¹Ù Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ 50 Ù†Ù‚Ø·Ø© Ù„ÙƒÙ„ Ø¥Ø­Ø§Ù„Ø©!</p>
            <input type="text" id="ref-link" readonly style="width: 90%; background: #000; color: #f1c40f; border: 1px solid #333; padding: 8px; text-align: center;">
            <button class="btn-action" onclick="copyRef()" style="margin-top: 10px;">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
        </div>
        <h4 style="margin-top: 20px;">Ø£ØµØ¯Ù‚Ø§Ø¤Ùƒ: <span id="ref-count">0</span></h4>
    </div>

    <div id="rank" class="section">
        <h4 style="color: #f1c40f;">ğŸ† Ù…ØªØµØ¯Ø±Ùˆ Ø§Ù„Ù†Ù‚Ø§Ø·</h4>
        <div id="score-rank" class="leaderboard-list"></div>
        <hr style="border: 0.5px solid #222; margin: 20px 0;">
        <h4 style="color: #f1c40f;">ğŸ”¥ Ø£Ø¨Ø·Ø§Ù„ Ø§Ù„Ø¯Ø¹ÙˆØ§Øª</h4>
        <div id="invite-rank" class="leaderboard-list"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDt6tmNq_On6_wnCbQdqmiMcNkgZAxGZPo",
            databaseURL: "https://age-game-d193d-default-rtdb.firebaseio.com",
            projectId: "age-game-d193d",
            appId: "1:1086396979239:web:6652b5bebee7f5126c1602"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· (id Ùˆ username)
        const params = new URLSearchParams(window.location.search);
        let uid = params.get('id') || localStorage.getItem('age_uid') || 'U' + Math.floor(Math.random() * 99999);
        let username = params.get('user') || 'Ù„Ø§Ø¹Ø¨ Ù…Ø¬Ù‡ÙˆÙ„';
        let inviter = params.get('ref'); // Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ Ø¯Ø¹Ø§Ùƒ

        localStorage.setItem('age_uid', uid);
        document.getElementById('username-display').innerText = "@" + username;
        document.getElementById('ref-link').value = `https://ageiq.xyz/?id=${uid}&ref=${uid}`; // Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ù„Ø£ÙˆÙ„ Ù…Ø±Ø©
        function checkReferral() {
            if (inviter && inviter !== uid) {
                const refKey = `referred_${uid}`;
                if (!localStorage.getItem(refKey)) {
                    db.ref('players/' + inviter).once('value', (s) => {
                        if (s.exists()) {
                            db.ref('players/' + inviter).update({
                                points: (s.val().points || 0) + 50,
                                invites: (s.val().invites || 0) + 1
                            });
                            localStorage.setItem(refKey, 'done');
                        }
                    });
                }
            }
        }

        // Ø­ÙØ¸ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…Ø¹ Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
        async function saveWallet() {
            const addr = document.getElementById('wallet-addr').value.trim();
            if (!/^0x[a-fA-F0-9]{40}$/.test(addr)) return alert("Ø¹Ù†ÙˆØ§Ù† ØºÙŠØ± ØµØ­ÙŠØ­!");

            const snapshot = await db.ref('players').orderByChild('wallet').equalTo(addr).once('value');
            if (snapshot.exists()) {
                alert("âŒ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­ÙØ¸Ø© Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø­Ø³Ø§Ø¨ Ø¢Ø®Ø± Ø¨Ø§Ù„ÙØ¹Ù„!");
            } else {
                db.ref('players/' + uid).update({ wallet: addr });
                alert("âœ… ØªÙ… Ø±Ø¨Ø· Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø¨Ù†Ø¬Ø§Ø­!");
            }
        }

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        db.ref('players/' + uid).on('value', (s) => {
            const d = s.val() || { points: 0, invites: 0 };
            document.getElementById('score').innerText = (d.points || 0).toLocaleString();
            document.getElementById('ref-count').innerText = d.invites || 0;
            if (d.wallet) {
                document.getElementById('wallet-addr').value = d.wallet;
                document.getElementById('save-btn').innerText = "ØªÙ… Ø§Ù„Ø±Ø¨Ø· âœ…";
                document.getElementById('save-btn').className = "btn-done";
            }
        });

        // Ø¬Ù„Ø¨ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
        function loadRankings() {
            db.ref('players').orderByChild('points').limitToLast(10).on('value', s => {
                let html = '';
                s.forEach(child => {
                    html = `<div class="rank-item"><span>${child.key}</span><b>${child.val().points}</b></div>` + html;
                });
                document.getElementById('score-rank').innerHTML = html;
            });

            db.ref('players').orderByChild('invites').limitToLast(10).on('value', s => {
                let html = '';
                s.forEach(child => {
                    html = `<div class="rank-item"><span>${child.key}</span><b>${child.val().invites || 0} Ø¯Ø¹ÙˆØ©</b></div>` + html;
                });
                document.getElementById('invite-rank').innerHTML = html;
            });
        }

        function copyRef() {
            const link = document.getElementById('ref-link');
            link.select();
            document.execCommand('copy');
            alert("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©!");
        }

        function switchTab(id, el) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
            if(id === 'rank') loadRankings();
        }

        checkReferral();
        loadRankings();
    </script>
</body>
</html>
